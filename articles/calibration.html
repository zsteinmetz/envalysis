<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="envalysis">
<title>Calibration workflow • envalysis</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calibration workflow">
<meta property="og:description" content="envalysis">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">envalysis</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/calibration.html">Calibration workflow</a>
    <a class="dropdown-item" href="../articles/texture.html">Particle size estimation</a>
    <a class="dropdown-item" href="../articles/theme_publish.html">ggplot2 theme for scientific publications</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/zsteinmetz/envalysis/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Calibration workflow</h1>
                        <h4 data-toc-skip class="author">Zacharias
Steinmetz</h4>
            
            <h4 data-toc-skip class="date">2023-09-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/zsteinmetz/envalysis/blob/HEAD/vignettes/calibration.Rmd" class="external-link"><code>vignettes/calibration.Rmd</code></a></small>
      <div class="d-none name"><code>calibration.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="packages">Packages<a class="anchor" aria-label="anchor" href="#packages"></a>
</h2>
<p>For the complete workflow, <strong>data.table</strong> and
<strong>ggplot2</strong> are required besides
<strong>envalysis</strong>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/zsteinmetz/envalysis" class="external-link">envalysis</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sample-data">Sample data<a class="anchor" aria-label="anchor" href="#sample-data"></a>
</h2>
<p>The sample data used stems from Steinmetz et al. (2019). It consists
of two tables: a sequence table and a sample table.</p>
<p>The sequence table contains gas-chromatography/mass spectrometry
measurement data of two phenolic compounds, these are tyrosol and
vanillin. Besides the samples, standard mixtures and extraction blanks
(type) were acquired in three separate analysis batches. Each
measurement resulted in an integrated peak area.</p>
<table class="table">
<thead><tr class="header">
<th align="left">Compound</th>
<th align="left">Type</th>
<th align="right">Batch</th>
<th align="left">Name</th>
<th align="right">Area</th>
<th align="right">Spec Conc</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Tyrosol</td>
<td align="left">Extraction blank</td>
<td align="right">1</td>
<td align="left">Blank 1</td>
<td align="right">0.000000</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">Tyrosol</td>
<td align="left">Extraction blank</td>
<td align="right">1</td>
<td align="left">Blank 2</td>
<td align="right">0.000000</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Tyrosol</td>
<td align="left">Sample</td>
<td align="right">1</td>
<td align="left">ZS-001</td>
<td align="right">328.343597</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">Tyrosol</td>
<td align="left">Sample</td>
<td align="right">1</td>
<td align="left">ZS-002</td>
<td align="right">282.930939</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Tyrosol</td>
<td align="left">Standard</td>
<td align="right">3</td>
<td align="left">0 mg/L</td>
<td align="right">0.000000</td>
<td align="right">0.00000</td>
</tr>
<tr class="even">
<td align="left">Tyrosol</td>
<td align="left">Standard</td>
<td align="right">3</td>
<td align="left">1 mg/L</td>
<td align="right">7.628456</td>
<td align="right">0.97755</td>
</tr>
<tr class="odd">
<td align="left">Tyrosol</td>
<td align="left">Standard</td>
<td align="right">3</td>
<td align="left">5 mg/L</td>
<td align="right">35.566628</td>
<td align="right">4.88775</td>
</tr>
<tr class="even">
<td align="left">Tyrosol</td>
<td align="left">Standard</td>
<td align="right">3</td>
<td align="left">20 mg/L</td>
<td align="right">141.898056</td>
<td align="right">19.55100</td>
</tr>
<tr class="odd">
<td align="left">Tyrosol</td>
<td align="left">Standard</td>
<td align="right">3</td>
<td align="left">100 mg/L</td>
<td align="right">715.496338</td>
<td align="right">97.75500</td>
</tr>
<tr class="even">
<td align="left">Vanillin</td>
<td align="left">Sample</td>
<td align="right">1</td>
<td align="left">ZS-001</td>
<td align="right">1876.933716</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Vanillin</td>
<td align="left">Sample</td>
<td align="right">1</td>
<td align="left">ZS-002</td>
<td align="right">1578.626099</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<p>The sample table describes the samples’ origin from a 29-day
degradation experiment, in which the phenolic compounds were either
degraded in the dark by the native soil microbial community or
photooxidized under UV irradiation after sterilizing the soil. The
samples were processed in threefold replication. Their weight [g], the
volume [mL] of extract solution, and the dilution factor were
recorded.</p>
<table class="table">
<thead><tr class="header">
<th align="left">Name</th>
<th align="right">Day</th>
<th align="left">Lighting</th>
<th align="left">Sterilization</th>
<th align="left">Treatment</th>
<th align="right">Replicate</th>
<th align="right">Weight</th>
<th align="right">Extract</th>
<th align="right">Dilution</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ZS-001</td>
<td align="right">0</td>
<td align="left">UV</td>
<td align="left">sterilized</td>
<td align="left">Photooxidation</td>
<td align="right">1</td>
<td align="right">2.5037</td>
<td align="right">12.5</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">ZS-002</td>
<td align="right">0</td>
<td align="left">UV</td>
<td align="left">sterilized</td>
<td align="left">Photooxidation</td>
<td align="right">2</td>
<td align="right">2.5018</td>
<td align="right">12.5</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">ZS-019</td>
<td align="right">0</td>
<td align="left">dark</td>
<td align="left">non-sterilized</td>
<td align="left">Biodegradation</td>
<td align="right">1</td>
<td align="right">2.5001</td>
<td align="right">12.5</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">ZS-164</td>
<td align="right">29</td>
<td align="left">dark</td>
<td align="left">non-sterilized</td>
<td align="left">Biodegradation</td>
<td align="right">2</td>
<td align="right">2.4992</td>
<td align="right">12.5</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">ZS-165</td>
<td align="right">29</td>
<td align="left">dark</td>
<td align="left">non-sterilized</td>
<td align="left">Biodegradation</td>
<td align="right">3</td>
<td align="right">2.5000</td>
<td align="right">12.5</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>In <strong>envalysis</strong>, the sample data is stored in a
two-item list called <code>phenolics</code>. The list items are named
<code>seq</code> and <code>samples</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"phenolics"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">phenolics</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co"># &gt; List of 2</span></span>
<span><span class="co"># &gt;  $ seq    :'data.frame':    160 obs. of  6 variables:</span></span>
<span><span class="co"># &gt;   ..$ Compound : Factor w/ 2 levels "Tyrosol","Vanillin": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co"># &gt;   ..$ Type     : Factor w/ 3 levels "Extraction blank",..: 1 1 2 2 2 2 2 2 2 2 ...</span></span>
<span><span class="co"># &gt;   ..$ Batch    : int [1:160] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co"># &gt;   ..$ Name     : chr [1:160] "Blank 1" "Blank 2" "ZS-001" "ZS-002" ...</span></span>
<span><span class="co"># &gt;   ..$ Area     : num [1:160] 0 0 328 283 296 ...</span></span>
<span><span class="co"># &gt;   ..$ Spec Conc: num [1:160] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co"># &gt;  $ samples:'data.frame':    42 obs. of  9 variables:</span></span>
<span><span class="co"># &gt;   ..$ Name         : chr [1:42] "ZS-001" "ZS-002" "ZS-003" "ZS-019" ...</span></span>
<span><span class="co"># &gt;   ..$ Day          : int [1:42] 0 0 0 0 0 0 1 1 1 1 ...</span></span>
<span><span class="co"># &gt;   ..$ Lighting     : Factor w/ 2 levels "dark","UV": 2 2 2 1 1 1 2 2 2 1 ...</span></span>
<span><span class="co"># &gt;   ..$ Sterilization: Factor w/ 2 levels "non-sterilized",..: 2 2 2 1 1 1 2 2 2 1 ...</span></span>
<span><span class="co"># &gt;   ..$ Treatment    : Factor w/ 2 levels "Biodegradation",..: 2 2 2 1 1 1 2 2 2 1 ...</span></span>
<span><span class="co"># &gt;   ..$ Replicate    : int [1:42] 1 2 3 1 2 3 1 2 3 1 ...</span></span>
<span><span class="co"># &gt;   ..$ Weight       : num [1:42] 2.5 2.5 2.5 2.5 2.5 ...</span></span>
<span><span class="co"># &gt;   ..$ Extract      : num [1:42] 12.5 12.5 12.5 12.5 12.5 12.5 12.5 12.5 12.5 12.5 ...</span></span>
<span><span class="co"># &gt;   ..$ Dilution     : int [1:42] 5 5 5 5 5 5 2 2 2 2 ...</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="simple-calibation">Simple calibation<a class="anchor" aria-label="anchor" href="#simple-calibation"></a>
</h2>
<p>Since the two phenolic compounds were analyzed in three different
batches, six individual calibration curves are required for
quantification. For better understanding, the calibration workflow is
first shown for a subset of data, namely the first batch of tyrosol
measurements. The subset is stored in <code>tyrosol_1</code>.</p>
<p>All standards in the <code>tyrosol_1</code> subset are used for
calibration. The <code>'calibration'</code> object is stored as
<code>cal_1</code>, which can be printed for additional information
including limits of detection and quantification, the adjusted
<em>R</em><sup>2</sup>, blanks, and statistical checks of the underlying
calibration model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tyrosol_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">phenolics</span><span class="op">$</span><span class="va">seq</span>, <span class="va">Compound</span> <span class="op">==</span> <span class="st">"Tyrosol"</span> <span class="op">&amp;</span> <span class="va">Batch</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cal_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calibration.html">calibration</a></span><span class="op">(</span><span class="va">Area</span> <span class="op">~</span> <span class="va">`Spec Conc`</span>,</span>
<span>                     data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">tyrosol_1</span>, <span class="va">Type</span> <span class="op">==</span> <span class="st">"Standard"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cal_1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co"># &gt; </span></span>
<span><span class="co"># &gt; Call:</span></span>
<span><span class="co"># &gt; calibration(formula = Area ~ `Spec Conc`, data = subset(tyrosol_1, </span></span>
<span><span class="co"># &gt;     Type == "Standard"))</span></span>
<span><span class="co"># &gt; </span></span>
<span><span class="co"># &gt; Coefficients:</span></span>
<span><span class="co"># &gt; (Intercept)  `Spec Conc`  </span></span>
<span><span class="co"># &gt;       3.762        7.508  </span></span>
<span><span class="co"># &gt; </span></span>
<span><span class="co"># &gt; Adjusted R-squared:  0.9998</span></span>
<span><span class="co"># &gt; Sum relative error:  1.558</span></span>
<span><span class="co"># &gt; </span></span>
<span><span class="co"># &gt; Blanks:</span></span>
<span><span class="co"># &gt; [1] 0.07470126 0.06534690 0.06093782 0.00000000</span></span>
<span><span class="co"># &gt; </span></span>
<span><span class="co"># &gt;     `Spec Conc`     lwr     upr</span></span>
<span><span class="co"># &gt; LOD      0.0144 0.00952  0.0293</span></span>
<span><span class="co"># &gt; LOQ      5.9300 3.92000 12.1000</span></span>
<span><span class="co"># &gt; </span></span>
<span><span class="co"># &gt; Check for normality of residuals:</span></span>
<span><span class="co"># &gt; </span></span>
<span><span class="co"># &gt;     Shapiro-Wilk normality test</span></span>
<span><span class="co"># &gt; </span></span>
<span><span class="co"># &gt; data:  residuals(calibration(formula = Area ~ `Spec Conc`, data = subset(tyrosol_1, )residuals(    Type == "Standard")))</span></span>
<span><span class="co"># &gt; W = 0.87897, p-value = 0.1841</span></span>
<span><span class="co"># &gt; </span></span>
<span><span class="co"># &gt; Check for homoscedasticity of residuals:</span></span>
<span><span class="co"># &gt; </span></span>
<span><span class="co"># &gt;     studentized Breusch-Pagan test</span></span>
<span><span class="co"># &gt; </span></span>
<span><span class="co"># &gt; data:  Area ~ `Spec Conc`</span></span>
<span><span class="co"># &gt; BP = 0.40323, df = 1, p-value = 0.5254</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cal_1</span><span class="op">)</span></span></code></pre></div>
<p><img src="calibration_files/figure-html/simple_calibration-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Based on <code>cal_1</code>, the tyrosol concentrations can be
calculated for all samples using <code><a href="../reference/calibration.html">inv_predict()</a></code>. The
argument <code>below_lod = 0</code> specifies that concentrations below
limit of detection (LOD) should be set to zero.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tyrosol_1</span><span class="op">$</span><span class="va">`Calc Conc`</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calibration.html">inv_predict</a></span><span class="op">(</span><span class="va">cal_1</span>, <span class="va">tyrosol_1</span><span class="op">$</span><span class="va">Area</span>, below_lod <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tyrosol_1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co"># &gt;   Compound             Type Batch    Name     Area Spec Conc Calc Conc</span></span>
<span><span class="co"># &gt; 1  Tyrosol Extraction blank     1 Blank 1   0.0000        NA   0.00000</span></span>
<span><span class="co"># &gt; 2  Tyrosol Extraction blank     1 Blank 2   0.0000        NA   0.00000</span></span>
<span><span class="co"># &gt; 3  Tyrosol           Sample     1  ZS-001 328.3436        NA  43.23037</span></span>
<span><span class="co"># &gt; 4  Tyrosol           Sample     1  ZS-002 282.9309        NA  37.18195</span></span>
<span><span class="co"># &gt; 5  Tyrosol           Sample     1  ZS-003 296.2863        NA  38.96072</span></span>
<span><span class="co"># &gt; 6  Tyrosol           Sample     1  ZS-019 243.0258        NA  31.86707</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="working-with-data-tables">Working with <code>data.table</code>s<a class="anchor" aria-label="anchor" href="#working-with-data-tables"></a>
</h2>
<p>To process all compounds and analysis batches together, the
<code>phenolics</code> data is converted to
<code>data.table</code>s.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">phenolics</span>, <span class="va">as.data.table</span><span class="op">)</span></span></code></pre></div>
<p>To replicate the following steps, try to organize your data in the
same way as shown before. If you want to read in your data directly as
<code>data.table</code>, use their <code><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread()</a></code> function, for
instance.</p>
</div>
<div class="section level2">
<h2 id="batch-calibration">Batch calibration<a class="anchor" aria-label="anchor" href="#batch-calibration"></a>
</h2>
<p>Subsequently, <code><a href="../reference/calibration.html">calibration()</a></code> and
<code><a href="../reference/calibration.html">inv_predict()</a></code> are applied by compound and batch.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dt</span><span class="op">$</span><span class="va">seq</span><span class="op">[</span>, <span class="va">`Calc Conc`</span> <span class="op">:=</span> <span class="fu"><a href="../reference/calibration.html">calibration</a></span><span class="op">(</span><span class="va">Area</span> <span class="op">~</span> <span class="va">`Spec Conc`</span>, <span class="va">.SD</span><span class="op">[</span><span class="va">Type</span> <span class="op">==</span> <span class="st">"Standard"</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>         <span class="fu"><a href="../reference/calibration.html">inv_predict</a></span><span class="op">(</span><span class="va">Area</span>, below_lod <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>       by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">Compound</span>, <span class="va">Batch</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dt</span><span class="op">$</span><span class="va">seq</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co"># &gt;    Compound             Type Batch    Name     Area Spec Conc Calc Conc</span></span>
<span><span class="co"># &gt; 1:  Tyrosol Extraction blank     1 Blank 1   0.0000        NA   0.00000</span></span>
<span><span class="co"># &gt; 2:  Tyrosol Extraction blank     1 Blank 2   0.0000        NA   0.00000</span></span>
<span><span class="co"># &gt; 3:  Tyrosol           Sample     1  ZS-001 328.3436        NA  43.23037</span></span>
<span><span class="co"># &gt; 4:  Tyrosol           Sample     1  ZS-002 282.9309        NA  37.18195</span></span>
<span><span class="co"># &gt; 5:  Tyrosol           Sample     1  ZS-003 296.2863        NA  38.96072</span></span>
<span><span class="co"># &gt; 6:  Tyrosol           Sample     1  ZS-019 243.0258        NA  31.86707</span></span></code></pre>
<p>Calibration parameters like LODs, LOQs, or adjusted
<em>R</em><sup>2</sup> may be stored in a separate list item for later
use.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dt</span><span class="op">$</span><span class="va">cal</span> <span class="op">&lt;-</span> <span class="va">dt</span><span class="op">$</span><span class="va">seq</span><span class="op">[</span><span class="va">Type</span> <span class="op">==</span> <span class="st">"Standard"</span>, <span class="fu"><a href="../reference/calibration.html">calibration</a></span><span class="op">(</span><span class="va">Area</span> <span class="op">~</span> <span class="va">`Spec Conc`</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"coef"</span>, <span class="st">"adj.r.squared"</span>, <span class="st">"lod"</span>, <span class="st">"loq"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">Compound</span>, <span class="va">Batch</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dt</span><span class="op">$</span><span class="va">cal</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co"># &gt;    Compound Batch (Intercept) `Spec Conc` adj.r.squared       lod       loq</span></span>
<span><span class="co"># &gt; 1:  Tyrosol     1  3.76202803    7.508184     0.9997915 0.0143933  5.925273</span></span>
<span><span class="co"># &gt; 2:  Tyrosol     2  3.07268449    7.601129     0.9992824 0.0092660 10.909912</span></span>
<span><span class="co"># &gt; 3:  Tyrosol     3  0.05587782    7.309053     0.9999764 0.0000000  2.311322</span></span>
<span><span class="co"># &gt; 4: Vanillin     1 25.17794786   51.529670     0.9998175 0.0040133  5.623778</span></span>
<span><span class="co"># &gt; 5: Vanillin     2 24.44314369   51.774820     0.9992359 0.0003509 11.408191</span></span>
<span><span class="co"># &gt; 6: Vanillin     3 10.62899985   50.819997     0.9999641 0.0000000  2.886073</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="blank-subtraction">Blank subtraction<a class="anchor" aria-label="anchor" href="#blank-subtraction"></a>
</h2>
<p>With the calculated concentrations at hand, the sample concentrations
are subtracted by the extraction blanks to correct for potential
lab-borne contamination.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dt</span><span class="op">$</span><span class="va">seq</span><span class="op">[</span>, <span class="va">`Clean Conc`</span> <span class="op">:=</span> <span class="va">`Calc Conc`</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span></span>
<span>  <span class="va">`Calc Conc`</span><span class="op">[</span><span class="va">Type</span> <span class="op">==</span> <span class="st">"Extraction blank"</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">Batch</span>, <span class="va">Compound</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="merging-tables">Merging tables<a class="anchor" aria-label="anchor" href="#merging-tables"></a>
</h2>
<p>The sequence table is merged with the sample table and the contents
of phenolic compounds are calculated from the extraction volume, sample
weight, and dilution factor.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dt</span><span class="op">$</span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">dt</span><span class="op">$</span><span class="va">seq</span>, <span class="va">dt</span><span class="op">$</span><span class="va">samples</span>, by <span class="op">=</span> <span class="st">"Name"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dt</span><span class="op">$</span><span class="va">res</span><span class="op">[</span>, <span class="va">Content</span> <span class="op">:=</span> <span class="va">`Clean Conc`</span> <span class="op">*</span> <span class="op">(</span><span class="va">Extract</span> <span class="op">/</span> <span class="va">Weight</span><span class="op">)</span> <span class="op">*</span> <span class="va">Dilution</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dt</span><span class="op">$</span><span class="va">res</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co"># &gt;      Name Compound   Type Batch      Area Spec Conc Calc Conc Clean Conc Day</span></span>
<span><span class="co"># &gt; 1: ZS-001  Tyrosol Sample     1  328.3436        NA  43.23037   43.23037   0</span></span>
<span><span class="co"># &gt; 2: ZS-001 Vanillin Sample     1 1876.9337        NA  35.93572   35.93572   0</span></span>
<span><span class="co"># &gt; 3: ZS-002  Tyrosol Sample     1  282.9309        NA  37.18195   37.18195   0</span></span>
<span><span class="co"># &gt; 4: ZS-002 Vanillin Sample     1 1578.6261        NA  30.14667   30.14667   0</span></span>
<span><span class="co"># &gt; 5: ZS-003  Tyrosol Sample     1  296.2863        NA  38.96072   38.96072   0</span></span>
<span><span class="co"># &gt; 6: ZS-003 Vanillin Sample     1 1593.6272        NA  30.43779   30.43779   0</span></span>
<span><span class="co"># &gt;    Lighting Sterilization      Treatment Replicate Weight Extract Dilution</span></span>
<span><span class="co"># &gt; 1:       UV    sterilized Photooxidation         1 2.5037    12.5        5</span></span>
<span><span class="co"># &gt; 2:       UV    sterilized Photooxidation         1 2.5037    12.5        5</span></span>
<span><span class="co"># &gt; 3:       UV    sterilized Photooxidation         2 2.5018    12.5        5</span></span>
<span><span class="co"># &gt; 4:       UV    sterilized Photooxidation         2 2.5018    12.5        5</span></span>
<span><span class="co"># &gt; 5:       UV    sterilized Photooxidation         3 2.5048    12.5        5</span></span>
<span><span class="co"># &gt; 6:       UV    sterilized Photooxidation         3 2.5048    12.5        5</span></span>
<span><span class="co"># &gt;      Content</span></span>
<span><span class="co"># &gt; 1: 1079.1621</span></span>
<span><span class="co"># &gt; 2:  897.0653</span></span>
<span><span class="co"># &gt; 3:  928.8800</span></span>
<span><span class="co"># &gt; 4:  753.1246</span></span>
<span><span class="co"># &gt; 5:  972.1515</span></span>
<span><span class="co"># &gt; 6:  759.4865</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="plotting">Plotting<a class="anchor" aria-label="anchor" href="#plotting"></a>
</h2>
<p>For plotting the data using <strong>ggplot2</strong>, the contents
are summarized by mean and confidence interval (CI).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dt</span><span class="op">$</span><span class="va">sum</span> <span class="op">&lt;-</span> <span class="va">dt</span><span class="op">$</span><span class="va">res</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>Content <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Content</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>                     CI <span class="op">=</span> <span class="fu"><a href="../reference/se.html">CI</a></span><span class="op">(</span><span class="va">Content</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">Compound</span>, <span class="va">Treatment</span>, <span class="va">Day</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dt</span><span class="op">$</span><span class="va">sum</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Day</span>, y <span class="op">=</span> <span class="va">Content</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">Content</span> <span class="op">-</span> <span class="va">CI</span>, ymax <span class="op">=</span> <span class="va">Content</span> <span class="op">+</span> <span class="va">CI</span>, group <span class="op">=</span> <span class="va">Treatment</span><span class="op">)</span>,</span>
<span>                width <span class="op">=</span> <span class="fl">1</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="va">Treatment</span>, fill <span class="op">=</span> <span class="va">Treatment</span><span class="op">)</span>,</span>
<span>             position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Day of incubation"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Phenolic content"</span><span class="op">~</span><span class="st">"["</span><span class="op">*</span><span class="va">mg</span><span class="op">~</span><span class="va">kg</span><span class="op">^</span><span class="op">-</span><span class="fl">1</span><span class="op">*</span><span class="st">"]"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Compound</span>, ncol <span class="op">=</span> <span class="fl">2</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">21</span>,<span class="fl">24</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"white"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/theme_publish.html">theme_publish</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="calibration_files/figure-html/plotting-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Steinmetz, Z., Kurtz, M.P., Zubrod, J.P., Meyer, A.H., Elsner, M.,
&amp; Schaumann, G.E. (2019) Biodegradation and photooxidation of
phenolic compounds in soil—A compound-specific stable isotope approach.
<em>Chemosphere</em> <strong>230</strong>, 210-218. DOI: <a href="https://doi.org/10.1016/j.chemosphere.2019.05.030" class="external-link">10.1016/j.chemosphere.2019.05.030</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Zacharias Steinmetz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
